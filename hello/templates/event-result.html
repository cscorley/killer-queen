{% extends 'base.html' %}

{% load tz %}

{% block scripts %}
{{ resultForm.media }}
{{ teamForm.media }}
{% endblock %}

{% block content %}

<div class="container">
    <h1>{{ event.name }}</h1>
    Tournament time: {{ event.when | timezone:event.timezone }} ({{ event.when | utc }} UTC) <br/>
    Tournament style: {{ event.tournament_style }} <br/>
    <div class="col-md-4">
        <h2>Teams</h2>
        <br />
        <ol>
        {% for team in event.teams.all|dictsort:"name" %}
            <li> {{ team.name }}
                {% if user.is_staff %} <small style="color: grey">(r={{ team.get_rating_mean |floatformat:1 }})</small> {% endif %}
                <br /><ol>
            {% for player in team.members.all|dictsort:"user.id" %}
                {% if player %}
                    <li> {{ player.user.get_full_name }}
                    {% if user.is_staff %} <small style="color: grey">({{ player.user.username }}, r={{ player.trueskill_rating_exposure|floatformat:1 }})</small> {% endif %}
                    </li>
                {% else %}
                    <strong><li> </li></strong>
                {% endif %}
            {% endfor %}
            </ol></li>
        {% endfor %}
        </ol>
    </div>

    <div class="col-md-8">
        <h2>Game results</h2>
        <br />
        <ol>
        {% for game in games %}
            <li>
                <span style="color: rgb(69, 122, 236)">{{ game.blue }}</span>
                wins:
                <strong> <span style="color: rgb(69, 122, 236)">{{ game.blue_win_count }}</span> </strong>
                <br />
                <span style="color: rgb(170, 131, 25)">{{ game.gold }}</span>
                wins:
                <strong> <span style="color: rgb(170, 131, 25)">{{ game.gold_win_count }}</span> </strong>
            </li>
        {% endfor %}
        </ol>
        {% if user.is_staff %}
            <hr />
            <form method="post">
                {% csrf_token %}
                <table>
                {% for field in teamForm %}
                    <tr style="vertical-align: middle">
                        <th> {{ field.label_tag }} </th>
                        <td> {{ field }} </td>
                    </tr>
                {% endfor %}
                </table>
                <button type="submit">Add team</button>
            </form>
            <hr />
            <form method="post">
                {% csrf_token %}
                <table>
                {% for field in resultForm %}
                    <tr style="vertical-align: middle">
                        <th> {{ field.label_tag }} </th>
                        <td> {{ field }} </td>
                    </tr>
                {% endfor %}
                </table>
                <button type="submit">Add result</button>
            </form>
        {% endif %}
    </div>
</div>

{% endblock %}
